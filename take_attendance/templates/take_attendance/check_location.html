{% extends 'base_dashboard.html' %}

{% block title %}Check Location{% endblock %}

{% block content %}
<div class="container mt-5" style="max-width: 500px;">
    <h1 class="text-center mb-4">Your Location</h1>

    <div id="loadingMessage" class="alert alert-info text-center" style="display: none;">
        Fetching your location, please wait...
    </div>

    <div id="coordsBox" class="alert alert-secondary text-center" style="display: none;">
        <strong>Latitude:</strong> <span id="latitude">-</span><br>
        <strong>Longitude:</strong> <span id="longitude">-</span>
    </div>

    <div id="errorMessage" class="alert alert-danger text-center" style="display: none;"></div>

    <div class="text-center mt-4">
        <button id="getLocationBtn" class="btn btn-primary">Get My Location</button>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const loadingMessage = document.getElementById('loadingMessage');
        const coordsBox = document.getElementById('coordsBox');
        const errorMessage = document.getElementById('errorMessage');
        const getLocationBtn = document.getElementById('getLocationBtn');
        const latitudeEl = document.getElementById('latitude');
        const longitudeEl = document.getElementById('longitude');

        function showError(message) {
            loadingMessage.style.display = 'none';
            coordsBox.style.display = 'none';
            errorMessage.style.display = 'block';
            errorMessage.textContent = message;
        }

        function showCoords(lat, lng) {
            loadingMessage.style.display = 'none';
            errorMessage.style.display = 'none';
            coordsBox.style.display = 'block';
            latitudeEl.textContent = lat;
            longitudeEl.textContent = lng;
        }

        function getLocation() {
            loadingMessage.style.display = 'block';
            coordsBox.style.display = 'none';
            errorMessage.style.display = 'none';

            if (!navigator.geolocation) {
                showError('Geolocation is not supported by your browser');
                return;
            }

            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    showCoords(lat, lng);
                },
                function(error) {
                    let errorMsg;
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            errorMsg = "Location access was denied. Please allow location access.";
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMsg = "Location information is unavailable.";
                            break;
                        case error.TIMEOUT:
                            errorMsg = "Location request timed out.";
                            break;
                        default:
                            errorMsg = "An unknown error occurred.";
                    }
                    showError(errorMsg);
                },
                { enableHighAccuracy: true }
            );
        }

        getLocationBtn.addEventListener('click', getLocation);

        // Optionally, auto-fetch on page load:
        // getLocation();
    });
</script>
{% endblock %}

